import command
from scanner import nmapper

def exploit(host,nmap, port):
    if port == 111:
        __nfs(host, nmap)
    elif port == 445 or port == 139:
        __smb(host)
    

def __smb(host):
    smbResult = command.run(['smbmap', '-H ' + host], capture_output=True).stdout
    if 'STATUS_ACCESS_DENIED' in smbResult:
        smbResult = command.run(['smbmap', '-u anonymous', '-H ' + host], capture_output=True).stdout

    if 'STATUS_ACCESS_DENIED' in smbResult or 'STATUS_LOGON_FAILURE' in smbResult:
        return

    print('\n smb open acces:')
    for line in iter(smbResult.splitlines()):
            if not line.startswith('[+]'):
                print(line)
        
        
        
def __nfs(host, nmap):
    if 'script' not in nmap: 
        return

    print(nmap['script']['nfs-showmount']) #TODO fix metasploitable so this can be tested and tweaked
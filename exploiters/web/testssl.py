import result
import command
from config import config
import os
from chache import chache
from shutil import copyfile
import main
import shlex


def exploit(url):
    if url.startswith('http://'):
        return
        
    print('testssl')
    chache.removeFile('testssl.html')
    testssl = config.getStatic('testsslPath')
    path = os.path.realpath(main.__file__).replace('main.py', '')
    cmd = testssl + ' --htmlfile ' + path + 'chache/testssl.html ' + url
    print(cmd)
    command.run(shlex.split(cmd), capture_output=False)

    html = chache.readFile('testssl.html')

    #find the colorcodes for red and/or orange in the html
    #orange: #cdcd00
    #red: #cd0000

    if '#cdcd00' in html:
        if '#cd0000' in html:
            print('testssl found errors') 
        else:
            print('testssl gave warnings')


        #copy html to working folder
        chache.movetocurrent('testssl.html')



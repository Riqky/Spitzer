from Spitzer.config import config
import subprocess

def exploit(nmap):
    print('screenshot!')
    hosts = ''
    for host in nmap:
        hosts += host + '\n'

    ports = '80, 443'
    for host, value in nmap:
        for port in value['tcp']:
            if 'http' in port['service'] and port not in ports:
                ports += ', ' + port

    path = config.get_path() + 'hosts.txt'
    open(path, 'w+').write(hosts)

    subprocess.run('cat ' + path + ' | aquatone -out screens -p ' + ports, check=True, text=True, shell=True)
    print('[*] Saved screenshots in screens')

    #move report named to current folder